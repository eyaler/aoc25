test = '''
.......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............
'''

full = '''
......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^.^...^...................................................................
.............................................................................................................................................
..................................................................^.....^.^..................................................................
.............................................................................................................................................
.................................................................^.^...^.^.^.................................................................
.............................................................................................................................................
................................................................^.^...^.^...^................................................................
.............................................................................................................................................
...............................................................^...^.....^...^...............................................................
.............................................................................................................................................
..............................................................^...^...^.^.^.^.^..............................................................
.............................................................................................................................................
.............................................................^.^.....^.^.^.....^.............................................................
.............................................................................................................................................
............................................................^.^.^.^...^.^.^...^.^............................................................
.............................................................................................................................................
...........................................................^.......^.^.^.^.^...^.^...........................................................
.............................................................................................................................................
..........................................................^...^.^.^.^.^...^...^.^.^..........................................................
.............................................................................................................................................
.........................................................^.^...^.^...^.....^.^.^.^.^.........................................................
.............................................................................................................................................
........................................................^.^...^.^.^.^.^...^.^.....^.^........................................................
.............................................................................................................................................
.......................................................^.^.^.^.^.^.^.....^.^.^.....^.^.......................................................
.............................................................................................................................................
......................................................^.^.^...^.^.^.^.^.^.^.^.^.^.....^......................................................
.............................................................................................................................................
.....................................................^...............^.^.^.....^...^...^.....................................................
.............................................................................................................................................
....................................................^.^.^.....^.^...^.^.^.^.....^.^...^.^....................................................
.............................................................................................................................................
...................................................^.^...^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^...................................................
.............................................................................................................................................
..................................................^.^.^.^.^.^.^...^.^.^...^.^.^.^.^...^.^.^..................................................
.............................................................................................................................................
.................................................^.^...^.^.^.^.....^.^.^...^.^.^...^...^.^.^.................................................
.............................................................................................................................................
................................................^...^...^.^...^.^.^.^.^.^.....^.^...^.^...^.^................................................
.............................................................................................................................................
...............................................^.....^.....^.^.^...^.^.^.^.^.....^.^.^.......^...............................................
.............................................................................................................................................
..............................................^.^...^.^.^.^.^...^...^.^.....^...^.^.^.....^.^.^..............................................
.............................................................................................................................................
.............................................^.^.^.^...^.^.....^.^.^.^.^.^.^.^.^.^.^.^...^...^.^.............................................
.............................................................................................................................................
............................................^.^.^.^...^.....^.^.^.^...^.^.^.^.^.^...^.^.^...^.^.^............................................
.............................................................................................................................................
...........................................^.^.^...^...^...^.^.^.^.^.^.....^...^.^.....^.^.....^.^...........................................
.............................................................................................................................................
..........................................^.....^.......^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.........^..........................................
.............................................................................................................................................
.........................................^.^...^.....^.^...^.^.^...^.^.^.^.......^.....^.^...^.^.^.^.........................................
.............................................................................................................................................
........................................^.^...^.^.^.^.^.^.^.......^.^.^...^.^.^...^.^.^.^...^.^...^.^........................................
.............................................................................................................................................
.......................................^...^...^.^.^.^.......^.^.^.^.^.^.^.^.^...^.^.....^...^.^...^.^.......................................
.............................................................................................................................................
......................................^.^...^.^.^...^.^.......^.........^...^...^.^...^.^...^.^.^.^...^......................................
.............................................................................................................................................
.....................................^.^.^.^.^.^.......^.^.^...^.^.^.^.^...^.^...^...^.^...^.^.^.^.^...^.....................................
.............................................................................................................................................
....................................^.^.^...^.^.^.^.^.^.....^...^.^.^.^.^.^.^.....^.^.^.........^.....^.^....................................
.............................................................................................................................................
...................................^.^.^.^.....^.^.^.^.^.^.^...^.^.^.....^...^.......^.^.^.^.^.^.^...^.^.^...................................
.............................................................................................................................................
..................................^...^.^.^.^...^.^...^...^.^...^.^.^...^...^...^.^.....^.....^.^.^...^.^.^..................................
.............................................................................................................................................
.................................^.^...^.^.^...^.^...^.^.........^.^.^.^.^.^.^.^.^...^...^.^...^.^.^.^.^.^.^.................................
.............................................................................................................................................
................................^...^.^.^.^.^.^.^.^.^.....^...^.^.........^...^.^...^...^.....^.^.....^...^.^................................
.............................................................................................................................................
...............................^.^.^.^...^.^.........^.^.^.^.^.....^.^.....^.^...^.^.^.^.^...^.^.^.....^.^.^.^...............................
.............................................................................................................................................
..............................^.^.^.^...^.^.^.^.^.^.....^.^.^...^...^.^.^.^.^...^.......^.^.^.^.^...^.^.....^.^..............................
.............................................................................................................................................
.............................^.^...^...^.........^...^.....^.^.^.^.^.^.^.^...^...^...^.^.^.^.^.....^.^.....^...^.............................
.............................................................................................................................................
............................^.^.^.^...^...^.^...^.^.......^...^.^.^...^.^.^.^.^...^...^.^.......^.^.^...^.^.^.^.^............................
.............................................................................................................................................
...........................^.^.^.^...^.^.^.^.^.^.^.^...^.^...^.^...^.^.^...^...^.^.^.^.^.^.....^...^.^.^.^.^.^...^...........................
.............................................................................................................................................
..........................^.....^.^.^.....^.^.......^.^...^...^.^.^...^.....^.^.^...^...^.^...^.^.^.^.^.^...^.^...^..........................
.............................................................................................................................................
.........................^.^.....^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^...^.^.....^.^...^.....^.^...^.^.........................
.............................................................................................................................................
........................^...^...^.^.^...^...........^.^...^.^.....^.^...^...^...^.....^.^.....^.^.^.........^.^...^.^........................
.............................................................................................................................................
.......................^.^.^.^...^.......^.^...^.^...^.^.^.....^.^.^.^.^.......^.^.^.^...^.^.....^.^.^.^...^.^.^.^...^.......................
.............................................................................................................................................
......................^.^.^.........^.^...^.^.^.....^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.^.^.^.^...^......................
.............................................................................................................................................
.....................^...^...^.^.^.^.....^...^.^...^.^.^...^.^.^...^.......^.^.^.^.^.^.^.^.^...^.^.....^...^.^.....^.^.^.....................
.............................................................................................................................................
....................^.^.^.^...^.^.^.^.^.^...^.^.^...^.....^...^...^.^...^.^.^.^...^.^.^.^.....^.^.^.^.....^...^.^.^.^...^....................
.............................................................................................................................................
...................^.......^.....^.^.^.^.^.^...^.^...^.^.^.....^...^...^.^.^.......^.^.^...^...^...^.^.^.....^.^.^...^.^.^...................
.............................................................................................................................................
..................^.^.^.^...^.^.^.^...^.^...^.^.^...^.^.^...^.^.....^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^...^.....^.^.....^.^..................
.............................................................................................................................................
.................^.^.^.^.^.^.^.^...^.^.^...^...^.^...^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.....^.....^.....^.^...^.^.^.^.^.....^.^.................
.............................................................................................................................................
................^.^...^.^.....^.^...^.^.^.....^...^...^.........^.^.^.^.^...^.^.^.^.....^.^.....^.^.....^.^.^.^.^.....^.^...^................
.............................................................................................................................................
...............^.^.....^.^...^.^...^.^.....^.^.^.^.^...^.^...^...^...^.^.^.^.^.^...^...^.^...^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^...............
.............................................................................................................................................
..............^.^.....^.^.^...^.^.^.^...^.^.^.....^.^.^.^.^.^.^.^.^.^...^...^.^...^.^.......^...^.......^...^.^.....^.^.^...^.^..............
.............................................................................................................................................
.............^.^.^.^...^.....^.^.^.^.^...^...........^...^.^.^.^.....^.^.^.^.^...^...^.^.....^.^.^.^.^...^.^...^.^...^...^.....^.............
.............................................................................................................................................
............^.....^.^.^.^.^.^...^...^.^.^...^.^...^.^.^.^.^.^.^.^.....^.^.^.^.^.^...^.^.^.^...^.^...^.....^.....^.^.....^.^.^.^.^............
.............................................................................................................................................
...........^.^...^.^...^.^...^.^.^.....^.^.^.^...^.....^.^...^.....^.^.^...^.^.^...^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^...^...........
.............................................................................................................................................
..........^.^.......^.^.^.....^...^.^...^.^.^.^...^.^.^.^...^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^...^.^.^.^.^.....^.^.^...^.^..........
.............................................................................................................................................
.........^.^.....^...^.^.^.^.^.^...^.....^.^.^.^.^.....^.^.^.^.^...^.......^...^.^.^.....^.^.^.^.^.^.^.^.^.^.....^.^...........^...^.........
.............................................................................................................................................
........^...^.......^.^.^.....^.^.^.^.^.^.^...^.....^...^.^.^.^.......^.^.^.........^...^...^.^...^.^.....^...^...^...^...^.....^...^........
.............................................................................................................................................
.......^...^.^.^...^...^.^.^.^...^...^.^.^...^.^.^.....^...^.^.^.^.......^.^...^.^.^.^.^...^...^.^.^...^.^.^...^.^.^.^.^.^...^...^...^.......
.............................................................................................................................................
......^.......^.......^.^.^.^.^.^...^.^...^.....^...^.^.^.^.^.^...^.^...^.^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.....^.^.^.^.^.^......
.............................................................................................................................................
.....^.^.....^.^.^.^...^.........^.^.^.^.^.^.^...^.^...^.^.^...^.....^...^.......^.^.^.^.^.......^.^.....^.^.^.^...^.^.^.^...^.^.......^.....
.............................................................................................................................................
....^.^.^.^...^.^.^.^.^.^...^...^.^.^.....^.....^...^.^.^.^.^.^.....^.^.....^.^.^...^.^.^.^.^.^.^.^.........^.^.......^.^...^.^.^.....^.^....
.............................................................................................................................................
...^.^.^.^.^.^.^...^...^.....^.^.^...^.^.^.^.^.^.^.^.....^.^...^...^.^.^.^.^...^.^...^.....^.^.^.^.^.^.^.^.^.^...^.^.......^.^...^.^...^.^...
.............................................................................................................................................
..^.^.^.^.^.^.^.^.......^...^.....^.^...^.^.^.^.^.^.^.^...^.....^.^.^.^...^.^.^.^...^...^.^.^.^.^.^.^.^.......^.^.^.....^.^...^.^.^...^...^..
.............................................................................................................................................
.^.^...^...^.^.^.^.....^.^.^.^.^...^.^...^.^.^...^.^.^.^.^.....^.^.......^.....^.....^...^...^.^.^.^.^...^.^...^.^...^.^.^.^.^.^.^...^.^...^.
.............................................................................................................................................
'''

rows = full.strip().splitlines()
rows = [list(row) for row in rows]

splits = 0
paths = [0] * len(rows[0])
print(''.join(rows[0]))
for y_above, row in enumerate(rows[1:]):
    for x, c in enumerate(row):
        if rows[y_above][x] not in '|S':
            continue
        if c == '.':
            row[x] = '|'
            if paths[x] == 0:
                paths[x] = 1
        elif c == '^':
            splits += 1
            row[x - 1] = '|'
            row[x + 1] = '|'
            paths[x - 1] += paths[x]
            paths[x + 1] += paths[x]
            paths[x] = 0
    print(''.join(row))
print(f'{splits=}, {sum(paths)=}')
